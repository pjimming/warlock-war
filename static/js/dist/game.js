class ChooseMode{constructor(t){this.root=t,this.$choose_mode=$('\n<div class="choose-mode">\n    <div class="choose-mode-single-mode" title="é™¤äº†è‡ªå·±ï¼Œéƒ½æ˜¯æ•Œäºº">\n        <img class="choose-mode-single-mode-img" src="https://pjmcode.top/static/image/choose_mode/3.png">\n        <div class="choose-mode-single-mode-title">\n            å•æœºæ¨¡å¼\n        </div>\n    </div>\n    <div class="choose-mode-multi-mode" title="å’ŒçœŸå®ç©å®¶æ¥ä¸€åœº1v1çš„å‹‡è€…å¯¹å†³">\n        <img class="choose-mode-multi-mode-img" src="https://pjmcode.top/static/image/choose_mode/2.png">\n        <div class="choose-mode-multi-mode-title">\n            è”ç½‘æ¨¡å¼\n        </div>\n    </div>\n    <div class="choose-mode-back">\n        è¿”å›\n    </div>\n</div>\n'),this.$choose_mode.hide(),this.root.$ac_game.append(this.$choose_mode),this.$single_mode=this.$choose_mode.find(".choose-mode-single-mode"),this.$multi_mode=this.$choose_mode.find(".choose-mode-multi-mode"),this.$back=this.$choose_mode.find(".choose-mode-back"),this.start()}start(){this.add_listening_event()}add_listening_event(){let t=this;this.$single_mode.click((function(){t.hide(),t.root.playground.show("single mode")})),this.$multi_mode.click((function(){t.hide(),t.root.playground.show("multi mode")})),this.$back.click((function(){t.hide(),t.root.menu.show()}))}show(){this.$choose_mode.show()}hide(){this.$choose_mode.hide()}}class Changelog{constructor(t){this.menu=t,this.$changelog=$('\n<div class="ac-game-changelog">\n    <div class="ac-game-changelog-logo"></div>\n    <br>\n    <div class="ac-game-changelog-author">\n        AUTHOR: &ensp;æ½˜æ±Ÿæ˜\n        <br><br>\n    </div>\n    <div class="ac-game-changelog-close" title="å…³é—­">\n        Ã—\n    </div>\n    <div class="ac-game-changelog-text">\n        2022.6.1<br>\n        &emsp;æœ‹å‹ä»¬ï¼ŒèŠ‚æ—¥å¿«ä¹ğŸ‰\n        <br>\n        <br>\n        2022.5.23<br>\n        &emsp;çƒ­çƒˆåº†ç¥Warlock Warä¸Šçº¿100å¤©ğŸ‰<br>\n        &emsp;é‡ç£…ï¼šWarlock Warè·å¾—è½¯ä»¶è‘—ä½œæƒ\n        <br>\n        <br>\n        2022.3.8<br>\n        &emsp;é‡ç£…ï¼šWarlock Warå®ç°QQä¸€é”®ç™»å½•åŠŸèƒ½\n        <br>\n        <br>\n        2022.2.28<br>\n        &emsp;é‡ç£…ï¼šWarlock Warå¯ç”¨æ–°åŸŸå&ensp;<a class="a-link" href="https://pjmcode.top/">pjmcode.top</a>\n        <br>\n        <br>\n        2022.2.27<br>\n        &emsp;ä¼˜åŒ–ï¼šè°ƒæ•´éƒ¨åˆ†æŠ€èƒ½çš„å‚æ•°<br>\n        &emsp;&emsp;ç–¾è·‘ï¼šå†·å´[8s->5s]ï¼Œé€Ÿåº¦æå‡[100%->80%]<br>\n        &emsp;&emsp;é—ªç°ï¼šå†·å´[3s->8s]<br>\n        &emsp;æ–°å¢ï¼šå±€å†…å¢åŠ ç–¾è·‘æ•ˆæœå‰©ä½™æ—¶é—´æç¤º\n        <br>\n        <br>\n        2022.2.25<br>\n        &emsp;ä¿®å¤ï¼šéƒ¨åˆ†å¹³å°ç™»å½•æ—¶ï¼Œé€‰æ‹©æ¨¡å¼ç•Œé¢å›¾ç‰‡åŠ è½½ä¸å‡ºçš„bug<br>\n        &emsp;æ–°å¢ï¼šå±€å†…æ–°å¢â€œç–¾è·‘â€æŠ€èƒ½ï¼ˆæŒ‰Wå³å¯ï¼ŒæŒç»­3sï¼Œå†·å´8sï¼Œé€Ÿåº¦æå‡100%ï¼‰\n        <br>\n        <br>\n        2022.2.24<br>\n        &emsp;<a class="a-link" href="https://m.weibo.cn/search?containerid=231522type%3D1%26t%3D10%26q%3D%23%E5%85%B3%E6%B3%A8%E4%BF%84%E4%B9%8C%E5%B1%80%E5%8A%BF%E6%9C%80%E6%96%B0%E8%BF%9B%E5%B1%95%23&extparam=%23%E5%85%B3%E6%B3%A8%E4%BF%84%E4%B9%8C%E5%B1%80%E5%8A%BF%E6%9C%80%E6%96%B0%E8%BF%9B%E5%B1%95%23" target="_blank">ä¿„ä¹Œå±€åŠ¿æœ€æ–°è¿›å±•</a><br>\n        &emsp;ä¿®å¤ï¼šWarlock ChatåŒè´¦å·ç™»å½•å‘é€ä¿¡æ¯ä¸ä¼šå®æ—¶æ›´æ–°çš„bug<br>\n        &emsp;ä¿®å¤ï¼šWarlock Chatå†æ¬¡ç™»å½•åŒä¸€è´¦å·ä¼šå‡ºç°ä¹‹å‰ç•Œé¢å†å²è®°å½•å‡ºç°ä¸¤æ¬¡çš„bug\n        <br>\n        <br>\n        2022.2.23<br>\n        &emsp;ä¼˜åŒ–ï¼šåˆå¹¶å•æœºæ¨¡å¼å’Œè”ç½‘æ¨¡å¼ï¼Œç®€æ´èœå•ç•Œé¢\n        <br>\n        <br>\n        2022.2.22<br>\n        &emsp;ç¥æ‚¨åœ¨æœ€æœ‰çˆ±çš„æ—¥å­é‡Œï¼Œæœ‰çˆ±æ‚¨çš„äººç›¸ä¼´<br>\n        &emsp;æ–°å¢ï¼šèœå•ç•Œé¢è®¾ç½®åŠŸèƒ½ï¼ˆå¯æ›´æ¢å¤´åƒï¼‰\n        <br>\n        <br>\n        2022.2.18<br>\n        &emsp;ä¿®å¤ï¼šéƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿›å…¥æ¸¸æˆåé—ªé€€çš„bug\n        <br>\n        <br>\n        2022.2.17<br>\n        &emsp;ä¼˜åŒ–ï¼šå±€å†…èŠå¤©ç³»ç»Ÿæ–‡æœ¬é¢œè‰²ä¼˜åŒ–<br>\n        &emsp;ä¼˜åŒ–ï¼šå•æœºæ¨¡å¼å†… AI çš®è‚¤é¢œè‰²å¢åŠ <br>\n        &emsp;æ–°å¢ï¼šèœå•ç•Œé¢ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º\n        <br>\n        <br>\n        2022.2.16<br>\n        &emsp;é‡ç£…ï¼šWarlock Chat æ­£å¼ä¸Šçº¿<br>\n        &emsp;ä¼˜åŒ–ï¼šæ¸¸æˆè¯´æ˜é¡µé¢è§†è§‰ä¼˜åŒ–<br>\n        &emsp;ä¼˜åŒ–ï¼šé¼ æ ‡æŒ‡é’ˆçš®è‚¤å…¨é¢æ›´æ–°<br>\n        &emsp;ä¼˜åŒ–ï¼šæ¸¸æˆç•Œé¢èƒŒæ™¯å…¨é¢ä¼˜åŒ–<br>\n        &emsp;æ–°å¢ï¼šWarlock War ä¸Šçº¿å¤©æ•°æ˜¾ç¤º\n        <br>\n        <br>\n        2022.2.15<br>\n        &emsp;å…ƒå®µèŠ‚å¿«ä¹ï¼<br>\n        &emsp;ä¼˜åŒ–ï¼šæ›´æ¢èƒŒæ™¯æ ·å¼ï¼Œä½¿èƒŒæ™¯æ›´è´´åˆæ¸¸æˆä¸»é¢˜æ°›å›´<br>\n        &emsp;ä¿®å¤ï¼šåœ¨èœå•æ¨¡å¼ä¸­ç‚¹å‡»å…¶ä»–æŒ‰é’®åæ›´æ–°æ—¥å¿—ä¸ä¼šè‡ªåŠ¨å…³é—­çš„bug\n        <br>\n        <br>\n        2022.2.14<br>\n        &emsp;æƒ…äººèŠ‚å¿«ä¹ï¼<br>\n        &emsp;ä¼˜åŒ–ï¼šUIé€‚é…ä¸åŒç±»å‹çª—å£<br>\n        &emsp;ä¼˜åŒ–ï¼šå±€å†…æ·»åŠ æŠ€èƒ½æŒ‰é”®æç¤º<br>\n        &emsp;æ–°å¢ï¼šç«çƒåˆ°è¾¾æœ€å¤§è·ç¦»åçƒŸèŠ±çˆ†ç‚¸æ•ˆæœï¼ˆä¸é€ æˆä¼¤å®³ï¼‰<br>\n        &emsp;æ–°å¢ï¼šç§»åŠ¨ç›®çš„åœ°çš„æç¤ºä½ç½®<br>\n        &emsp;ä¿®å¤ï¼šæŸäº›æƒ…å†µä¸‹æ¸¸æˆç»“æŸåä¸èƒ½æ­£å¸¸é‡æ–°å¼€å§‹çš„bug\n        <br>\n        <br>\n        2022.2.13<br>\n        &emsp;Warlock War 1.0 æ­£å¼ä¸Šçº¿\n    </div>\n</div>\n'),this.$changelog.hide(),this.menu.root.$ac_game.append(this.$changelog),this.$close=this.$changelog.find(".ac-game-changelog-close"),this.start()}start(){this.add_listening_event()}add_listening_event(){let t=this;this.$close.click((function(){t.hide()}))}show(){this.$changelog.show()}hide(){this.$changelog.hide()}}class GameHelper{constructor(t){this.menu=t,this.$helper=$('\n<div class="ac-game-helper">\n    <div class="ac-game-helper-text">\n        AUTHOR: &emsp;æ½˜æ±Ÿæ˜\n        <br>\n        <br>\n        ===æ¨èPCç«¯æ¸¸ç©===<br>\n        ç§»åŠ¨ï¼šé¼ æ ‡å³é”®ç‚¹å‡»æ¡Œé¢å³å¯ç§»åŠ¨è‡³ç›®æ ‡åœ°ç‚¹<br>\n        æ”»å‡»ï¼šæŒ‰Qé”® + é¼ æ ‡å·¦é”®å³å¯å‘ç›®æ ‡å¤„å‘å°„ç«çƒ<br>\n        é—ªç°ï¼šæŒ‰Fé”® + é¼ æ ‡å·¦é”®å³å¯ç¬ç§»è‡³ç›®æ ‡å¤„<br>\n        ç–¾è·‘ï¼šæŒ‰Wé”® é€Ÿåº¦æå‡80%ï¼ŒæŒç»­2.5s<br>\n        å±€å†…èŠå¤©(è”ç½‘æ¨¡å¼)ï¼šæŒ‰ENTERé”®å¯å‘¼å”¤å‡ºèŠå¤©æ¡†<br>\n        è‹¥å·²è¾“å…¥å†…å®¹ï¼ŒæŒ‰ESCé”®å¯å…³é—­èŠå¤©æ¡†ï¼ŒæŒ‰ENTERé”®å‘é€ï¼›<br>\n        è‹¥æœªè¾“å…¥å†…å®¹ï¼ŒæŒ‰ENTERé”®å¯ç›´æ¥å…³é—­èŠå¤©æ¡†\n    </div>\n    <br>\n    <div class="ac-game-helper-back">\n        è¿”å›\n    </div>\n</div>\n'),this.$helper.hide(),this.menu.root.$ac_game.append(this.$helper),this.$back=this.$helper.find(".ac-game-helper-back"),this.start()}start(){this.add_listening_events()}add_listening_events(){let t=this;this.$back.click((function(){t.hide(),t.menu.show()}))}show(){this.$helper.show()}hide(){this.$helper.hide()}}class OnlineDays{constructor(t){this.menu=t,this.$onlinedays=this.calc_days(),this.$onlinedays.show(),this.menu.$menu.append(this.$onlinedays),this.start()}start(){}calc_days(){let t=new Date(2022,1,13),e=new Date;t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e=new Date(e.getFullYear(),e.getMonth(),e.getDate());const s=e.getTime()-t.getTime();return $(`<div class="onlinedays">Warlock War å·²ä¸Šçº¿ ${s/864e5+1} å¤©</div>`)}show(){this.$onlinedays.show()}hide(){this.$onlinedays.hide()}}class ReplacePhoto{constructor(t){this.menu=t,this.username=this.menu.user_info.username,this.cur_photo=this.menu.user_info.photo,this.$replace_photo=$(`\n<div class="replace-photo">\n    <div class="replace-photo-username">\n        ç”¨æˆ·åï¼š${this.username}\n    </div>\n    <img class="replace-photo-cur-photo-img" src="${this.cur_photo}" alt="å½“å‰å¤´åƒ">\n    <div class="replace-photo-cur-photo-text">\n        å½“å‰å¤´åƒåœ°å€ï¼š\n    </div>\n    <div class="replace-photo-cur-photo-url">\n        ${this.cur_photo}\n    </div>\n    <div class="replace-photo-close" title="å…³é—­">\n        Ã—\n    </div>\n    <div class="replace-photo-new-photo-text">\n        ä¿®æ”¹å¤´åƒï¼š\n    </div>\n    <input type="text" class="replace-photo-new-photo-url" placeholder="è¯·åœ¨bingä¸­æŸ¥æ‰¾å›¾ç‰‡ å‰ç¼€ä¾‹å¦‚ï¼šhttps://tse1-mm.cn.bing.net/">\n    <div class="replace-photo-new-photo-tip">\n        &emsp;tips:é¼ æ ‡å³é”®å•å‡»å›¾ç‰‡ï¼Œç‚¹å‡»â€œåœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å›¾ç‰‡â€ï¼Œå¤åˆ¶å›¾ç‰‡é“¾æ¥å³å¯ã€‚\n    </div>\n    <div class="replace-photo-new-photo-confirm" title="ä¿å­˜å½“å‰çŠ¶æ€">\n        ä¿å­˜\n    </div>\n    <div class="replace-photo-error-message"></div>\n</div>\n`),this.$replace_photo.hide(),this.menu.$menu.append(this.$replace_photo),this.$close=this.$replace_photo.find(".replace-photo-close"),this.$confirm=this.$replace_photo.find(".replace-photo-new-photo-confirm"),this.$input=this.$replace_photo.find(".replace-photo-new-photo-url"),this.$replace_photo_error_message=this.$replace_photo.find(".replace-photo-error-message"),this.start()}start(){this.add_listening_event()}add_listening_event(){let t=this;this.$close.click((function(){t.hide()})),this.$confirm.click((function(){t.update_photo()})),this.$input.keydown((function(e){13===e.which&&t.update_photo()}))}update_photo(){let t=this,e=this.$input.val();this.$replace_photo_error_message.empty(),$.ajax({url:"https://pjmcode.top/warlockwar/menu/replace_photo/",type:"GET",data:{username:t.username,photo:e},success:function(e){"success"===e.result?location.reload():t.$replace_photo_error_message.html(e.result)}})}show(){this.$replace_photo.show()}hide(){this.$replace_photo.hide()}}class WarlockChatSocket{constructor(t){this.menu=t,this.uuid=this.menu.uuid,this.ws=new WebSocket("wss://pjmcode.top/wss/warlockchat/"),this.start()}start(){this.receive()}receive(){let t=this;this.ws.onmessage=function(e){let s=JSON.parse(e.data),i=s.event;"message"===i?t.receive_message(s.uuid,s.username,s.time,s.text):"init"===i&&t.receive_init(s.details)}}send_init(t){this.ws.send(JSON.stringify({event:"init",username:t,uuid:this.uuid}))}receive_init(t){for(let e=0;e<t.length;e++){let s=t[e],i=s.username,a=s.time,n=s.text;this.menu.warlock_chat.add_message(i,a,n)}}send_message(t,e,s){this.ws.send(JSON.stringify({event:"message",uuid:this.uuid,username:t,time:e,text:s}))}receive_message(t,e,s,i){t!==this.uuid&&this.menu.warlock_chat.add_message(e,s,i)}}class UserInfo{constructor(t){this.menu=t,this.photo=this.menu.root.settings.photo,this.username=this.menu.root.settings.username,this.$photo=$(`<img class="user-info-photo" src="${this.photo}" alt="æ‚¨çš„å¤´åƒ">`),this.$username=$(`<div class="user-info-username">${this.username}</div>`),this.$photo.show(),this.$username.show(),this.menu.$menu.append(this.$photo),this.menu.$menu.append(this.$username),this.start()}start(){}}class WarlockChat{constructor(t){this.menu=t,this.$title=$('<div class="message-board-title">Warlock Chat</div>'),this.$history=$('<div class="message-board-history"></div>'),this.$input=$('<input type="text" class="message-board-input" placeholder="ç•™ä¸‹ä½ çš„è¶³è¿¹">'),this.$title.show(),this.$history.show(),this.$input.show(),this.menu.$menu.append(this.$title),this.menu.$menu.append(this.$history),this.menu.$menu.append(this.$input),this.start()}start(){this.add_listening_event()}add_listening_event(){let t=this;this.$input.keydown((function(e){if(13===e.which){let e=t.menu.root.settings.username,s=t.$input.val();if(s){t.$input.val(""),Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t};let i=(new Date).format("yyyy-MM-dd hh:mm:ss");t.add_message(e,i,s),t.menu.wcs.send_message(e,i,s)}return!1}}))}add_message(t,e,s){let i=`[${t}][${e}]<br>${s}`,a="black";t===this.menu.root.settings.username&&(a="green"),this.$history.append(this.render_message(i,a)),this.$history.scrollTop(this.$history[0].scrollHeight)}render_message(t,e){return $(`<div style="color:${e}">${t}</div>`)}}class AcGameMenu{constructor(t){this.root=t,this.uuid=this.create_uuid(),this.$menu=$('\n<div class="ac-game-menu">\n    <footer>\n        &copy;<a class="beian-link" href="http://pjmcode.top/">æ½˜æ±Ÿæ˜</a>\n        |\n        <a class="beian-link" href="http://beian.miit.gov.cn/" target="_blank" title="å·¥ä¸šå’Œä¿¡æ¯åŒ–éƒ¨åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ">\n           æµ™ICPå¤‡2022005619å·-1\n        </a>\n    </footer>\n    <div class="ac-game-menu-field">\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-helper" title="ç›¸å…³æ“ä½œè¯´æ˜">\n            æ¸¸æˆè¯´æ˜\n        </div>\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-choose-mode" title="å‡†å¤‡å¥½äº†å—ï¼Œæ¥é€‰æ‹©æ¨¡å¼å§ï¼">\n            è¿›å…¥æ¸¸æˆ\n        </div>\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-changelog">\n            æ›´æ–°æ—¥å¿—\n        </div>\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-settings" title="ä¿®æ”¹å¤´åƒ">\n            è®¾ç½®\n        </div>\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-logout" title="é€€å‡ºå½“å‰è´¦å·">\n            é€€å‡º\n        </div>\n    </div>\n</div>\n'),this.root.$ac_game.append(this.$menu),this.$helper=this.$menu.find(".ac-game-menu-field-item-helper"),this.$choose_mode=this.$menu.find(".ac-game-menu-field-item-choose-mode"),this.$changelog=this.$menu.find(".ac-game-menu-field-item-changelog"),this.$settings=this.$menu.find(".ac-game-menu-field-item-settings"),this.$logout=this.$menu.find(".ac-game-menu-field-item-logout"),this.onlinedays=new OnlineDays(this),this.game_helper=new GameHelper(this),this.changelog=new Changelog(this),this.user_info=new UserInfo(this),this.settings=new ReplacePhoto(this),this.warlock_chat=new WarlockChat(this),this.wcs=new WarlockChatSocket(this);let e=this;this.wcs.ws.onopen=function(){e.wcs.send_init(e.root.settings.username)},this.start()}start(){this.add_listening_events()}create_uuid(){let t="";for(let e=0;e<8;e++){t+=parseInt(Math.floor(10*Math.random()))}return t}add_listening_events(){let t=this;this.$helper.click((function(){t.hide(),t.changelog.hide(),t.game_helper.show()})),this.$choose_mode.click((function(){t.hide(),t.changelog.hide(),t.root.choose_mode.show()})),this.$changelog.click((function(){t.settings.hide(),t.changelog.show()})),this.$settings.click((function(){t.changelog.hide(),t.settings.show()})),this.$logout.click((function(){t.changelog.hide(),t.root.settings.logout_on_remote()}))}show(){this.$menu.show()}hide(){this.$menu.hide(),this.settings.hide()}}let last_timestamp,AC_GAME_OBJECTS=[];class AcGameObject{constructor(){AC_GAME_OBJECTS.push(this),this.has_called_start=!1,this.timedelta=0,this.uuid=this.create_uuid()}create_uuid(){let t="";for(let e=0;e<8;e++){t+=parseInt(Math.floor(10*Math.random()))}return t}start(){}update(){}late_update(){}on_destroy(){}destroy(){this.on_destroy();for(let t=0;t<AC_GAME_OBJECTS.length;t++)if(AC_GAME_OBJECTS[t]===this){AC_GAME_OBJECTS.splice(t,1);break}}}let AC_GAME_ANIMATION=function(t){for(let e=0;e<AC_GAME_OBJECTS.length;e++){let s=AC_GAME_OBJECTS[e];s.has_called_start?(s.timedelta=t-last_timestamp,s.update()):(s.start(),s.has_called_start=!0)}for(let t=0;t<AC_GAME_OBJECTS.length;t++){AC_GAME_OBJECTS[t].late_update()}last_timestamp=t,requestAnimationFrame(AC_GAME_ANIMATION)};requestAnimationFrame(AC_GAME_ANIMATION);class ChatField{constructor(t){this.playground=t,this.$history=$('<div class="ac-game-chat-field-history">å†å²è®°å½•</div>'),this.$input=$('<input type="text" class="ac-game-chat-field-input" placeholder="å‘é€ä¸€å¥å‹å¥½çš„é—®å€™è§è¯å½“ä¸‹"></input>'),this.$history.hide(),this.$input.hide(),this.func_id=null,this.playground.$playground.append(this.$history),this.playground.$playground.append(this.$input),this.start()}start(){this.add_listening_event()}add_listening_event(){let t=this;this.$history.on("contextmenu",(function(){return!1})),this.$input.keydown((function(e){if(27===e.which)return t.hide_input(),!1;if(13===e.which){let e=t.playground.root.settings.username,s=t.$input.val();return s?(t.$input.val(""),t.add_message(e,s),t.playground.mps.send_message(e,s)):t.hide_input(),!1}}))}render_message(t,e){return $(`<div style="color:${e}">${t}</div>`)}add_message(t,e){this.show_history();let s=`[${t}]:${e}`,i="white";t===this.playground.root.settings.username&&(i="lime"),this.$history.append(this.render_message(s,i)),this.$history.scrollTop(this.$history[0].scrollHeight)}show_history(){let t=this;this.$history.fadeIn(),this.func_id&&clearTimeout(this.func_id),this.func_id=setTimeout((function(){t.$history.fadeOut(),t.func_id=null}),3e3)}show_input(){this.show_history(),this.$input.show(),this.$input.focus()}hide_input(){this.$input.hide(),this.playground.game_map.$canvas.focus()}}class FinallBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.state=null,this.win_img=new Image,this.win_img.src="https://cdn.acwing.com/media/article/image/2022/02/12/106788_3c4e02858c-win.png",this.lose_img=new Image,this.lose_img.src="https://cdn.acwing.com/media/article/image/2022/02/12/106788_3546c3128c-lose.png"}start(){}win(){this.state="win";let t=this;setTimeout((function(){t.playground.hide(),t.playground.root.choose_mode.show()}),2e3)}lose(){this.state="lose";let t=this;setTimeout((function(){t.playground.hide(),t.playground.root.choose_mode.show()}),2e3)}late_update(){this.render()}render(){let t=this.playground.height/2,e=this.playground.width/2;"win"===this.state?this.ctx.drawImage(this.win_img,this.playground.width/2-e/2,this.playground.height/2-t/2,e,t):"lose"===this.state&&this.ctx.drawImage(this.lose_img,this.playground.width/2-e/2,this.playground.height/2-t/2,e,t)}}class GameMap extends AcGameObject{constructor(t){super(),this.playground=t,this.$canvas=$("<canvas tabindex=0></canvas>"),this.ctx=this.$canvas[0].getContext("2d"),this.ctx.canvas.width=this.playground.width,this.ctx.canvas.height=this.playground.height,this.playground.$playground.append(this.$canvas),this.background_img=new Image,"single mode"===this.playground.mode?this.background_img.src="https://cdn.acwing.com/media/article/image/2022/02/16/106788_4d7828ed8f-single.jpg":"multi mode"===this.playground.mode&&(this.background_img.src="https://cdn.acwing.com/media/article/image/2022/02/16/106788_7f79857a8f-multi.jpg")}start(){this.$canvas.focus()}resize(){this.ctx.canvas.width=this.playground.width,this.ctx.canvas.height=this.playground.height,this.ctx.save(),this.ctx.beginPath(),this.ctx.drawImage(this.background_img,0,0,this.ctx.canvas.width,this.ctx.canvas.height)}update(){this.render()}render(){this.ctx.globalAlpha=.28,this.ctx.save(),this.ctx.beginPath(),this.ctx.drawImage(this.background_img,0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalAlpha=1}}class NoticeBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.text="å·²å°±ç»ªï¼š0äºº",this.sprint_text=""}start(){}write(t){this.text=t}write_sprint(t){this.sprint_text=t}update(){this.render()}render(){this.ctx.font="20px serif",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(this.text,this.playground.width/2,20)}render_sprint(){this.ctx.font="25px serif",this.ctx.fillText(this.sprint_text,this.playground.width/8,25)}}class Particle extends AcGameObject{constructor(t,e,s,i,a,n,h,o,r){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.x=e,this.y=s,this.radius=i,this.vx=a,this.vy=n,this.color=h,this.speed=o,this.move_length=r,this.friction=.9,this.eps=.01}start(){}update(){if(this.move_length<this.eps||this.speed<this.eps)return this.destroy(),!1;let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.speed*=this.friction,this.move_length-=t,this.render()}render(){let t=this.playground.scale;this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()}}class Player extends AcGameObject{constructor(t,e,s,i,a,n,h,o,r){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.x=e,this.y=s,this.vx=0,this.vy=0,this.radius=i,this.color=a,this.speed=n,this.character=h,this.username=o,this.photo=r,this.move_length=0,this.cur_skill=null,this.friction=.9,this.spent_time=0,this.damage_x=0,this.damage_y=0,this.damage_speed=0,this.fireballs=[],this.is_sprint=!1,this.sprint_time=0,this.eps=.01,"robot"!==this.character&&(this.img=new Image,this.img.src=this.photo),"me"===this.character&&(this.fireball_coldtime=1,this.fireball_img=new Image,this.fireball_img.src="https://cdn.acwing.com/media/article/image/2022/02/13/106788_b4ad44c18c-fireball.png",this.blink_coldtime=8,this.blink_img=new Image,this.blink_img.src="https://cdn.acwing.com/media/article/image/2022/02/13/106788_b212e4278c-blink-f.png",this.sprint_coldtime=5,this.sprint_img=new Image,this.sprint_img.src="https://cdn.acwing.com/media/article/image/2022/02/24/106788_79431c9595-sprint.png")}start(){if(this.playground.player_count+=1,this.playground.notice_board.write("å·²å°±ç»ªï¼š"+this.playground.player_count+"äºº"),this.playground.player_count>=2&&(this.playground.state="fighting",this.playground.notice_board.write("å¼€å§‹æˆ˜æ–—ï¼ï¼ï¼")),"me"===this.character)this.add_listening_events();else if("robot"===this.character){let t=Math.random()*this.playground.width/this.playground.scale,e=Math.random()*this.playground.height/this.playground.scale;this.move_to(t,e)}}add_listening_events(){let t=this;this.playground.game_map.$canvas.on("contextmenu",(function(){return!1})),this.playground.game_map.$canvas.mousedown((function(e){if("fighting"!==t.playground.state)return!0;const s=t.ctx.canvas.getBoundingClientRect();if(3===e.which){let i=(e.clientX-s.left)/t.playground.scale,a=(e.clientY-s.top)/t.playground.scale;for(let e=0;e<4;e++){let s=i,n=a,h=.0025,o=2*Math.PI*(e/4+.125),r=Math.cos(o),l=Math.sin(o),c="white",d=.3,g=.02;new Particle(t.playground,s,n,h,r,l,c,d,g)}t.move_to(i,a),"multi mode"===t.playground.mode&&t.playground.mps.send_move_to(i,a)}else if(1===e.which){let i=(e.clientX-s.left)/t.playground.scale,a=(e.clientY-s.top)/t.playground.scale;if("fireball"===t.cur_skill){if(t.fireball_coldtime>t.eps)return!1;let e=t.shoot_fireball(i,a);"multi mode"===t.playground.mode&&t.playground.mps.send_shoot_fireball(i,a,e.uuid)}else if("blink"===t.cur_skill){if(t.blink_coldtime>t.eps)return!1;t.blink(i,a),"multi mode"===t.playground.mode&&t.playground.mps.send_blink(i,a)}t.cur_skill=null}})),this.playground.game_map.$canvas.keydown((function(e){if(13===e.which){if("multi mode"===t.playground.mode)return t.playground.chat_field.show_input(),!1}else 27===e.which&&"multi mode"===t.playground.mode&&t.playground.chat_field.hide_input();return"fighting"!==t.playground.state||(81===e.which?t.fireball_coldtime>t.eps||(t.cur_skill="fireball",!1):70===e.which?t.blink_coldtime>t.eps||(t.cur_skill="blink",!1):87===e.which?t.sprint_coldtime>t.eps||(t.sprint(),"multi mode"===t.playground.mode&&t.playground.mps.send_sprint(),!1):void 0)}))}sprint(){this.speed*=1.8,this.sprint_time=3,this.is_sprint=!0,this.sprint_coldtime=5}blink(t,e){let s=this.get_dist(this.x,this.y,t,e);s=Math.min(s,.8);let i=Math.atan2(e-this.y,t-this.x);this.x+=s*Math.cos(i),this.y+=s*Math.sin(i),this.blink_coldtime=8,this.move_length=0}shoot_fireball(t,e){let s=this.x,i=this.y,a=Math.atan2(e-i,t-s),n=Math.cos(a),h=Math.sin(a),o="orange";"multi mode"===this.playground.mode&&(o="red");let r=new FireBall(this.playground,this,s,i,.01,n,h,o,.6,1,.01);return this.fireballs.push(r),this.fireball_coldtime=1,r}destroy_fireball(t){for(let e=0;e<this.fireballs.length;e++){let s=this.fireballs[e];if(s.uuid===t){s.destroy();break}}}is_attacked(t,e){for(let t=0;t<20+10*Math.random();t++){let t=this.x,e=this.y,s=this.radius*Math.random()*.1,i=2*Math.PI*Math.random(),a=Math.cos(i),n=Math.sin(i),h=this.color,o=10*this.speed,r=this.radius*Math.random()*5;new Particle(this.playground,t,e,s,a,n,h,o,r)}if(this.radius-=e,this.radius<this.eps)return this.destroy(),!1;this.damage_x=Math.cos(t),this.damage_y=Math.sin(t),this.damage_speed=100*e,this.speed*=1.1}receive_attack(t,e,s,i,a,n){n.destroy_fireball(a),this.x=t,this.y=e,this.is_attacked(s,i)}get_dist(t,e,s,i){let a=t-s,n=e-i;return Math.sqrt(a*a+n*n)}move_to(t,e){this.move_length=this.get_dist(this.x,this.y,t,e);let s=Math.atan2(e-this.y,t-this.x);this.vx=Math.cos(s),this.vy=Math.sin(s)}update(){this.spent_time+=this.timedelta/1e3,this.update_win(),"fighting"===this.playground.state&&"me"===this.character&&this.update_coldtime(),this.update_sprint(),this.update_move(),this.render()}update_win(){1===this.playground.player_count&&"fighting"===this.playground.state&&"me"===this.character&&(this.playground.state="over",this.playground.notice_board.write("æ­å–œï¼Œæ‚¨èµ¢äº†ï¼ï¼ï¼"),this.playground.finall_board.win())}update_coldtime(){this.fireball_coldtime-=this.timedelta/1e3,this.fireball_coldtime=Math.max(this.fireball_coldtime,0),this.blink_coldtime-=this.timedelta/1e3,this.blink_coldtime=Math.max(this.blink_coldtime,0),this.sprint_coldtime-=this.timedelta/1e3,this.sprint_coldtime=Math.max(this.sprint_coldtime,0)}update_sprint(){this.sprint_time-=this.timedelta/1e3,this.sprint_time=Math.max(this.sprint_time,0),this.playground.notice_board.write_sprint("ç–¾è·‘å‰©ä½™"+this.sprint_time.toFixed(1)+"s"),this.sprint_time>this.eps&&this.playground.notice_board.render_sprint();for(let t=0;t<this.playground.players.length;t++){let e=this.playground.players[t];e.is_sprint&&e.sprint_time<this.eps&&(e.is_sprint=!1,e.speed/=2)}}update_move(){if("robot"===this.character&&this.spent_time>4&&Math.random()<1/180){let t=this.playground.players[Math.floor(Math.random()*this.playground.players.length)];if(this!==t){let e=t.x+t.speed*t.vx*(.3+.5*Math.random()),s=t.y+t.speed*t.vy*(.3+.5*Math.random());this.shoot_fireball(e,s)}}if(this.damage_speed>this.eps)this.vx=this.vy=0,this.move_length=0,this.x+=this.damage_x*this.damage_speed*this.timedelta/1e3,this.y+=this.damage_y*this.damage_speed*this.timedelta/1e3,this.damage_speed*=this.friction;else if(this.move_length<this.eps){if(this.move_length=0,this.vx=this.vy=0,"robot"===this.character){let t=Math.random()*this.playground.width/this.playground.scale,e=Math.random()*this.playground.height/this.playground.scale;this.move_to(t,e)}}else{let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t}}render(){let t=this.playground.scale;"robot"!==this.character?(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.img,(this.x-this.radius)*t,(this.y-this.radius)*t,2*this.radius*t,2*this.radius*t),this.ctx.restore()):(this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()),"me"===this.character&&"fighting"===this.playground.state&&this.render_skill_coldtime()}render_skill_coldtime(){let t=this.playground.scale,e=1.38,s=.9,i=.04;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e*t,s*t,i*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.fireball_img,(e-i)*t,(s-i)*t,2*i*t,2*i*t),this.ctx.restore(),this.fireball_coldtime>0&&(this.ctx.beginPath(),this.ctx.moveTo(e*t,s*t),this.ctx.arc(e*t,s*t,i*t,0-Math.PI/2,2*Math.PI*(1-this.fireball_coldtime/1)-Math.PI/2,!0),this.ctx.lineTo(e*t,s*t),this.ctx.fillStyle="rgba(0, 0, 255, 0.6)",this.ctx.fill()),e=1.5,s=.9,i=.04,this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e*t,s*t,i*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.blink_img,(e-i)*t,(s-i)*t,2*i*t,2*i*t),this.ctx.restore(),this.blink_coldtime>0&&(this.ctx.beginPath(),this.ctx.moveTo(e*t,s*t),this.ctx.arc(e*t,s*t,i*t,0-Math.PI/2,2*Math.PI*(1-this.blink_coldtime/8)-Math.PI/2,!0),this.ctx.lineTo(e*t,s*t),this.ctx.fillStyle="rgba(0, 0, 255, 0.6)",this.ctx.fill()),e=1.62,s=.9,i=.04,this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e*t,s*t,i*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.sprint_img,(e-i)*t,(s-i)*t,2*i*t,2*i*t),this.ctx.restore(),this.sprint_coldtime>0&&(this.ctx.beginPath(),this.ctx.moveTo(e*t,s*t),this.ctx.arc(e*t,s*t,i*t,0-Math.PI/2,2*Math.PI*(1-this.sprint_coldtime/5)-Math.PI/2,!0),this.ctx.lineTo(e*t,s*t),this.ctx.fillStyle="rgba(0, 0, 255, 0.6)",this.ctx.fill())}on_destroy(){"me"===this.character&&"fighting"===this.playground.state&&(this.playground.state="lose",this.playground.notice_board.write("æ‚¨å·²é˜µäº¡ï¼Œæ¸¸æˆç»“æŸã€‚"));for(let t=0;t<this.playground.players.length;t++)if(this.playground.players[t]===this){this.playground.players.splice(t,1),this.playground.player_count-=1;break}this.playground.player_count<=1&&"lose"===this.playground.state&&(this.playground.state="waiting",this.playground.finall_board.lose())}}class FireBall extends AcGameObject{constructor(t,e,s,i,a,n,h,o,r,l,c){super(),this.playground=t,this.player=e,this.ctx=this.playground.game_map.ctx,this.x=s,this.y=i,this.radius=a,this.vx=n,this.vy=h,this.color=o,this.speed=r,this.move_length=l,this.damage=c,this.eps=.01}start(){}update(){if(this.move_length<this.eps){for(let t=0;t<20+10*Math.random();t++){let t=this.x,e=this.y,s=.005,i=2*Math.PI*Math.random(),a=Math.cos(i),n=Math.sin(i),h=this.color,o=1,r=.2;new Particle(this.playground,t,e,s,a,n,h,o,r)}return this.destroy(),!1}this.update_move(),"enemy"!==this.player.character&&this.update_attack(),this.render()}update_move(){let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t}update_attack(){for(let t=0;t<this.playground.players.length;t++){let e=this.playground.players[t];if(this.player!==e&&this.is_collision(e)){this.attack(e);break}}}attack(t){let e=Math.atan2(t.y-this.y,t.x-this.x);t.is_attacked(e,this.damage),"multi mode"===this.playground.mode&&this.playground.mps.send_attack(t.uuid,t.x,t.y,e,this.damage,this.uuid),this.destroy()}is_collision(t){return this.get_dist(this.x,this.y,t.x,t.y)<this.radius+t.radius}get_dist(t,e,s,i){let a=t-s,n=e-i;return Math.sqrt(a*a+n*n)}render(){let t=this.playground.scale;this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()}on_destroy(){let t=this.player.fireballs;for(let e=0;e<t.length;e++)if(t[e]===this){t.splice(e,1);break}}}class IceBall extends AcGameObject{constructor(t,e,s,i,a,n,h,o,r,l,c){super(),this.playground=t,this.player=e,this.ctx=this.playground.game_map.ctx,this.x=s,this.y=i,this.radius=a,this.vx=n,this.vy=h,this.color=o,this.speed=r,this.move_length=l,this.damage=c,this.eps=.01}start(){}update(){}}class MultiPlayerSocket{constructor(t){this.playground=t,this.ws=new WebSocket("wss://pjmcode.top/wss/multiplayer/"),this.start()}start(){this.receive()}receive(){let t=this;this.ws.onmessage=function(e){let s=JSON.parse(e.data),i=s.uuid;if(i===t.uuid)return!1;let a=s.event;"create_player"===a?t.receive_create_player(i,s.username,s.photo):"move_to"===a?t.receive_move_to(i,s.tx,s.ty):"shoot_fireball"===a?t.receive_shoot_fireball(i,s.tx,s.ty,s.ball_uuid):"attack"===a?t.receive_attack(i,s.attackee_uuid,s.x,s.y,s.angle,s.damage,s.ball_uuid):"blink"===a?t.receive_blink(i,s.tx,s.ty):"message"===a?t.receive_message(i,s.username,s.text):"sprint"===a&&t.receive_sprint(i)}}get_player(t){let e=this.playground.players;for(let s=0;s<e.length;s++){let i=e[s];if(i.uuid===t)return i}return null}send_create_player(t,e){this.ws.send(JSON.stringify({event:"create_player",uuid:this.uuid,username:t,photo:e}))}receive_create_player(t,e,s){let i=new Player(this.playground,this.playground.width/2/this.playground.scale,.5,.05,"white",.2,"enemy",e,s);i.uuid=t,this.playground.players.push(i)}send_move_to(t,e){this.ws.send(JSON.stringify({event:"move_to",uuid:this.uuid,tx:t,ty:e}))}receive_move_to(t,e,s){let i=this.get_player(t);i&&i.move_to(e,s)}send_shoot_fireball(t,e,s){this.ws.send(JSON.stringify({event:"shoot_fireball",uuid:this.uuid,tx:t,ty:e,ball_uuid:s}))}receive_shoot_fireball(t,e,s,i){let a=this.get_player(t);if(a){a.shoot_fireball(e,s).uuid=i}}send_attack(t,e,s,i,a,n){this.ws.send(JSON.stringify({event:"attack",uuid:this.uuid,attackee_uuid:t,x:e,y:s,angle:i,damage:a,ball_uuid:n}))}receive_attack(t,e,s,i,a,n,h){let o=this.get_player(t),r=this.get_player(e);o&&r&&r.receive_attack(s,i,a,n,h,o)}send_blink(t,e){this.ws.send(JSON.stringify({event:"blink",uuid:this.uuid,tx:t,ty:e}))}receive_blink(t,e,s){let i=this.get_player(t);i&&i.blink(e,s)}send_message(t,e){this.ws.send(JSON.stringify({event:"message",uuid:this.uuid,username:t,text:e}))}receive_message(t,e,s){this.playground.chat_field.add_message(e,s)}send_sprint(){this.ws.send(JSON.stringify({event:"sprint",uuid:this.uuid}))}receive_sprint(t){let e=this.get_player(t);e&&e.sprint()}}class AcGamePlayground{constructor(t){this.root=t,this.$playground=$('<div class="ac-game-playground"></div>'),this.hide(),this.root.$ac_game.append(this.$playground),this.start()}get_random_color(){return["blue","green","yellow","red","pink","purple","grey","aqua","skyblue","greenyellow","gold","peachpuff","plum","lightpink","wheat"][Math.floor(15*Math.random())]}create_uuid(){let t="";for(let e=0;e<8;e++){t+=parseInt(Math.floor(10*Math.random()))}return t}start(){let t=this,e=this.create_uuid();$(window).on(`resize.${e}`,(function(){t.resize()})),this.root.acwingos&&this.root.acwingos.api.window.on_close((function(){$(window).off(`resize.${e}`)}))}resize(){this.width=this.$playground.width(),this.height=this.$playground.height();let t=Math.min(this.width/16,this.height/9);this.width=16*t,this.height=9*t,this.scale=this.height,this.game_map&&this.game_map.resize()}show(t){let e=this;if(this.$playground.show(),this.mode=t,this.width=this.$playground.width(),this.height=this.$playground.height(),this.game_map=new GameMap(this),this.state="waiting",this.notice_board=new NoticeBoard(this),this.finall_board=new FinallBoard(this),this.player_count=0,this.resize(),this.players=[],this.players.push(new Player(this,this.width/2/this.scale,.5,.05,"white",.2,"me",this.root.settings.username,this.root.settings.photo)),"single mode"===t)for(let t=0;t<7;t++)this.players.push(new Player(this,this.width/2/this.scale,.5,.05,this.get_random_color(),.2,"robot"));else"multi mode"===t&&(this.chat_field=new ChatField(this),this.mps=new MultiPlayerSocket(this),this.mps.uuid=this.players[0].uuid,this.mps.ws.onopen=function(){e.mps.send_create_player(e.root.settings.username,e.root.settings.photo)})}hide(){for(;this.players&&this.players.length>0;){let t=this.players[0];for(;t.fireballs&&t.fireballs.length>0;)t.fireballs[0].destroy();this.players[0].destroy()}this.game_map&&(this.game_map.destroy(),this.game_map=null),this.notice_board&&(this.notice_board.destroy(),this.notice_board=null),this.finall_board&&(this.finall_board.destroy(),this.finall_board=null),this.$playground.empty(),this.$playground.hide()}}class Settings{constructor(t){"app1356.acapp.acwing.com.cn"===window.location.host&&window.location.replace("https://pjmcode.top/warlockwar/"),this.root=t,this.platform="WEB",this.root.acwingos&&(this.platform="ACAPP"),this.username="",this.photo="",this.$settings=$('\n<div class="ac-game-settings">\n    <footer>\n        &copy;<a class="beian-link" href="http://pjmcode.top/">æ½˜æ±Ÿæ˜</a>\n        |\n        <a class="beian-link" href="http://beian.miit.gov.cn/" target="_blank" title="å·¥ä¸šå’Œä¿¡æ¯åŒ–éƒ¨åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ">\n            æµ™ICPå¤‡2022005619å·-1\n        </a>\n    </footer>\n    <div class="ac-game-settings-login">\n        <div class="ac-game-settings-title">\n            ç™»å½•\n        </div>\n        <div class="ac-game-settings-username">\n            <div class="ac-game-settings-item">\n                <input type="text" placeholder="ç”¨æˆ·å">\n            </div>\n        </div>\n        <div class="ac-game-settings-password">\n            <div class="ac-game-settings-item">\n                <input type="password" placeholder="å¯†ç ">\n            </div>\n        </div>\n        <div class="ac-game-settings-submit">\n            <div class="ac-game-settings-item">\n                <button>ç™»å½•</button>\n            </div>\n        </div>\n        <div class="ac-game-settings-error-message">\n        </div>\n        <div class="ac-game-settings-option">\n            æ³¨å†Œ\n        </div>\n        <br>\n        <img class="ac-game-settings-qq-logo" width=70 src="https://pjmcode.top/static/image/settings/qq.png">\n        <div class="ac-game-settings-qq-text">\n            ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸€é”®ç™»å½•\n        </div>\n    </div>\n    <div class="ac-game-settings-register">\n        <div class="ac-game-settings-title">\n            æ³¨å†Œ\n        </div>\n        <div class="ac-game-settings-username">\n            <div class="ac-game-settings-item">\n                <input type="text" placeholder="ç”¨æˆ·å">\n            </div>\n        </div>\n        <div class="ac-game-settings-password ac-game-settings-password-first">\n            <div class="ac-game-settings-item">\n                <input type="password" placeholder="å¯†ç ">\n            </div>\n        </div>\n        <div class="ac-game-settings-password ac-game-settings-password-second">\n            <div class="ac-game-settings-item">\n                <input type="password" placeholder="ç¡®è®¤å¯†ç ">\n            </div>\n        </div>\n        <div class="ac-game-settings-submit">\n            <div class="ac-game-settings-item">\n                <button>æ³¨å†Œ</button>\n            </div>\n        </div>\n        <div class="ac-game-settings-error-message">\n        </div>\n        <div class="ac-game-settings-option">\n            ç™»å½•\n        </div>\n        <br>\n        <img class="ac-game-settings-qq-logo" width=70 src="https://pjmcode.top/static/image/settings/qq.png">\n        <div class="ac-game-settings-qq-text">\n            ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸€é”®ç™»å½•\n        </div>\n    </div>\n</div>\n'),this.$login=this.$settings.find(".ac-game-settings-login"),this.$login_username=this.$login.find(".ac-game-settings-username input"),this.$login_password=this.$login.find(".ac-game-settings-password input"),this.$login_submit=this.$login.find(".ac-game-settings-submit button"),this.$login_error_message=this.$login.find(".ac-game-settings-error-message"),this.$login_register=this.$login.find(".ac-game-settings-option"),this.$register=this.$settings.find(".ac-game-settings-register"),this.$register_username=this.$register.find(".ac-game-settings-username input"),this.$register_password=this.$register.find(".ac-game-settings-password-first input"),this.$register_password_confirm=this.$register.find(".ac-game-settings-password-second input"),this.$register_submit=this.$register.find(".ac-game-settings-submit button"),this.$register_error_message=this.$register.find(".ac-game-settings-error-message"),this.$register_login=this.$register.find(".ac-game-settings-option"),this.$register.hide(),this.$qq_login=this.$settings.find(".ac-game-settings-qq-logo"),this.root.$ac_game.append(this.$settings),this.start()}start(){"ACAPP"===this.platform?this.getinfo_acapp():(this.getinfo_web(),this.add_listening_events())}add_listening_events(){let t=this;this.add_listening_events_login(),this.add_listening_events_register(),this.$qq_login.click((function(){t.qq_login()}))}add_listening_events_login(){let t=this;this.$login_register.click((function(){t.register()})),this.$login_submit.click((function(){t.login_on_remote()}))}add_listening_events_register(){let t=this;this.$register_login.click((function(){t.login()})),this.$register_submit.click((function(){t.register_on_remote()}))}qq_login(){$.ajax({url:"https://pjmcode.top/warlockwar/settings/qq/apply_code/",type:"GET",success:function(t){"success"===t.result&&window.location.replace(t.apply_code_url)}})}acwing_login(){$.ajax({url:"https://pjmcode.top/warlockwar/settings/acwing/web/apply_code/",type:"GET",success:function(t){"success"===t.result&&window.location.replace(t.apply_code_url)}})}login_on_remote(){let t=this,e=this.$login_username.val(),s=this.$login_password.val();this.$login_error_message.empty(),$.ajax({url:"https://pjmcode.top/warlockwar/settings/login/",type:"GET",data:{username:e,password:s},success:function(e){"success"===e.result?location.reload():t.$login_error_message.html(e.result)}})}logout_on_remote(){"ACAPP"===this.platform?this.root.acwingos.api.window.close():$.ajax({url:"https://pjmcode.top/warlockwar/settings/logout/",type:"GET",success:function(t){"success"===t.result&&location.reload()}})}register_on_remote(){let t=this,e=this.$register_username.val(),s=this.$register_password.val(),i=this.$register_password_confirm.val();this.$register_error_message.empty(),$.ajax({url:"https://pjmcode.top/warlockwar/settings/register/",type:"GET",data:{username:e,password:s,password_confirm:i},success:function(e){"success"===e.result?location.reload():t.$register_error_message.html(e.result)}})}login(){this.$register.hide(),this.$login.show()}register(){this.$login.hide(),this.$register.show()}acapp_login(t,e,s,i){let a=this;this.root.acwingos.api.oauth2.authorize(t,e,s,i,(function(t){"success"===t.result&&(a.username=t.username,a.photo=t.photo,a.hide(),a.root.menu=new AcGameMenu(a.root),a.root.menu.show(),a.root.menu.changelog.show())}))}getinfo_acapp(){let t=this;$.ajax({url:"https://pjmcode.top/warlockwar/settings/acwing/acapp/apply_code/",type:"GET",success:function(e){"success"===e.result&&t.acapp_login(e.appid,e.redirect_uri,e.scope,e.state)}})}getinfo_web(){let t=this;$.ajax({url:"https://pjmcode.top/warlockwar/settings/getinfo/",type:"GET",data:{platform:t.platform},success:function(e){"success"===e.result?(t.username=e.username,t.photo=e.photo,t.hide(),t.root.menu=new AcGameMenu(t.root),t.root.menu.show(),t.root.menu.changelog.show()):t.login()}})}hide(){this.$settings.hide()}show(){this.$settings.show()}}export class AcGame{constructor(t,e){this.id=t,this.$ac_game=$("#"+t),this.acwingos=e,this.settings=new Settings(this),this.choose_mode=new ChooseMode(this),this.playground=new AcGamePlayground(this),this.start()}start(){}}
